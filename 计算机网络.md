# 缓存
## CDN缓存
#### 什么是cdn缓存
cdn缓存就是加在浏览器和服务器之间的一个缓存机制，缓存一些html/css/图片等一些静态资源。
#### 无CDN缓存时：
用户在浏览网站时，浏览器会缓存一些图片或者其他文件，当用户再次浏览时，就不需要再次下载文件了，提高了页面的加载速度。
#### 有cdn缓存时：
浏览器首先检查本地是否有缓存/缓存是否过期，如果缓存过期，会向最近的cdn边缘节点发送请求，cdn边缘节点会检查缓存的请求数据是否过期，如果没有过期则直接响应
客户，如果过期则cdn向源站点发送回源请求，获取最新的数据再返回给用户。
#### cdn缓存机制：
浏览器缓存失效时，浏览器会向cdn边缘节点发送请求，cdn边缘节点也有一套缓存机制。
1. 用户输入url时，浏览器会调用域名解析库对域名进行解析，得到的是该域名对应的CNAME记录，为了得到实际的IP，浏览器必须再一次进行解析，在这个过程中，使用
的是全局负载均衡DNS解析，根据就近原则及负荷情况，解析到最近最优的CDN缓存服务器的IP地址，浏览器向cdn缓存服务器发送请求，cdn缓存服务器根据浏览器提供的
域名，通过内部的DNS解析得到源服务器的IP地址，由cdn缓存服务器向该服务器发送请求。
## 浏览器缓存
### 强缓存 
强缓存是利用http返回头中Expires或者Cache-Control两个字段来控制的，用来表示资源缓存的时间。
#### Expires：
http1.0规范的，值是一个绝对的时间，代表资源的失效时间，存在的问题是如果浏览器与服务器之间的时间有差距，导致缓存混乱。
#### Cache-Contorl
* http1.1出现的，主要利用该字段的max-age值进行判断，它是一个相对时间，Cache-Control:max-age=3600
* 其他字段：
  1. no-cache表示不使用本地缓存，使用缓存协商。
  2. no-store：禁止缓存
### 协商缓存
协商缓存是由服务器来确定缓存资源是否可用
#### Last-Modify/If-Modify-Since
浏览器第一次请求时，服务器返回的header会加上Last-Modify。当浏览器再次请求时，request请求头会包含If-Modify-Since，服务器根据该头部，根据最后修改时间判断是否命中缓存，如果命中，返回304，并不会返回资源内容。
#### Etag/If-None-Match
与上面不同的是，Etag返回的是一个校验码，他可以保证每一个资源都是唯一的，资源变化会导致Eag变化，服务器根据浏览器发送的If-None-Match值判断是否命中缓存
#### 为什么要有Etag
* 一些文件周期性更改但是内容不改
* 某些文件修改频繁，If-Modified-Since能检查到s级别的。
* 某些服务器不能精确得到文件最后修改时间。

# Http1.0/Http1.1/Http2.0区别
## Http1.0/Http2.0
* 缓存处理：在http1.0中主要使用header里的If-Modified-Since，Expires来做缓存判断，http1.1引入了If-Match/If-None-Match更多的缓存头来控制。
* 长连接：http1.1支持长连接，在一个tcp连接上可以传送多个http请求和响应。默认Connection：keey-alive。
* Host头处理：随着虚拟主机的技术发展，在一台设备上存放多个虚拟主机，他们共享一个IP，http1.1请求头和响应头都支持host
* 宽带优化： http1.0存在宽带浪费，客户端只需要对象的一部分，而服务器却将整个对象都发送过来，http1.1在请求头引入range，允许只请求资源某个部分，返回码是206
